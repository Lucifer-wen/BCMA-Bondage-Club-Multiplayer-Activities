(()=>{"use strict";const e=Object.freeze([{id:"ClubCard",difficulty:0,labelSelf:"(Practice the Club Card mini-game.)",descriptionSelf:"(Launches a solo Club Card practice round.)",labelTarget:"(Invite DialogCharacterObject to play Club Card.)",descriptionTarget:"(Launches a Club Card practice round for you and DialogCharacterObject.)"},{id:"Chess",difficulty:0,labelSelf:"(Play a practice chess match.)",descriptionSelf:"(Loads the chess mini-game locally.)",labelTarget:"(Challenge DialogCharacterObject to chess.)",descriptionTarget:"(Loads the chess mini-game for you and DialogCharacterObject.)"},{id:"DojoStruggle",difficulty:0,labelSelf:"(Run a dojo struggle drill.)",descriptionSelf:"(Starts the dojo struggle mini-game.)",labelTarget:"(Invite DialogCharacterObject to a dojo struggle drill.)",descriptionTarget:"(Starts the dojo struggle mini-game for DialogCharacterObject.)"},{id:"GetUp",difficulty:0,labelSelf:"(Attempt the Get Up challenge.)",descriptionSelf:"(Starts the Get Up mini-game with a basic difficulty.)",labelTarget:"(Make DialogCharacterObject attempt the Get Up challenge.)",descriptionTarget:"(Starts the Get Up mini-game so DialogCharacterObject can practice.)"},{id:"MaidCleaning",difficulty:"Normal",labelSelf:"(Start maid cleaning practice.)",descriptionSelf:"(Runs the maid cleaning mini-game at a normal pace.)",labelTarget:"(Invite DialogCharacterObject to maid cleaning practice.)",descriptionTarget:"(Runs the maid cleaning mini-game for DialogCharacterObject.)"},{id:"MaidDrinks",difficulty:"Normal",labelSelf:"(Start maid drink service practice.)",descriptionSelf:"(Runs the maid drink service mini-game at a normal pace.)",labelTarget:"(Invite DialogCharacterObject to maid drink service practice.)",descriptionTarget:"(Runs the maid drink service mini-game for DialogCharacterObject.)"},{id:"HorseWalk",difficulty:"Hurdle",labelSelf:"(Race through a horse walk hurdle course.)",descriptionSelf:"(Runs the horse walk mini-game on the hurdle preset.)",labelTarget:"(Invite DialogCharacterObject to a horse walk hurdle course.)",descriptionTarget:"(Runs the horse walk mini-game so DialogCharacterObject can compete.)"},{id:"MagicPuzzle",difficulty:20,labelSelf:"(Practice spell casting puzzles.)",descriptionSelf:"(Loads a Magic Puzzle session.)",labelTarget:"(Invite DialogCharacterObject to practice spell casting puzzles.)",descriptionTarget:"(Loads a Magic Puzzle session for you and DialogCharacterObject.)"},{id:"Therapy",difficulty:1,labelSelf:"(Start a therapy mini-game.)",descriptionSelf:"(Runs the therapy mini-game locally.)",labelTarget:"(Invite DialogCharacterObject to the therapy mini-game.)",descriptionTarget:"(Runs the therapy mini-game for DialogCharacterObject.)"},{id:"Tennis",difficulty:1,labelSelf:"(Practice a tennis mini-game.)",descriptionSelf:"(Loads the tennis mini-game locally.)",labelTarget:"(Invite DialogCharacterObject to tennis drills.)",descriptionTarget:"(Loads the tennis mini-game for you and DialogCharacterObject.)"}]),a=new Map(e.map(e=>[e.id,e])),t="9100",i="9200",r=Symbol("bcma-self-dialog"),n=Symbol("bcma-target-dialog");let o,l;function c(e=10){!function(){let e=!1;if(Player&&(e=s(Player)||e),Array.isArray(ChatRoomCharacter))for(const a of ChatRoomCharacter)e=s(a)||e;return e}()&&e>0&&setTimeout(()=>c(e-1),500)}function s(e){return!(!e||!Array.isArray(e.Dialog))&&(e.IsPlayer?.()?function(e){if(e[r])return!1;const a=e.Dialog;if(!Array.isArray(a))return!1;let i=!1;i=u(a,f({Stage:"100",NextStage:t,Option:"(BCMA: Launch an activity.)",Result:"(Pick one of the club's built-in mini-games to play or practice.)",Prerequisite:"DialogBCMACanShowMiniGamesSelf()"}))||i;for(const e of g(!0))i=u(a,e)||i;return i&&(e[r]=!0),i}(e):!!e.IsOnline?.()&&function(e){if(e[n])return!1;const a=e.Dialog;if(!Array.isArray(a))return!1;let t=!1;t=u(a,f({Stage:"40",NextStage:i,Option:"(BCMA: Invite DialogCharacterObject to an activity.)",Result:"(Pick one of the club's built-in mini-games to launch locally.)",Prerequisite:"DialogBCMACanShowMiniGamesTarget()"}))||t;for(const e of g(!1))t=u(a,e)||t;return t&&(e[n]=!0),t}(e))}function g(a){const r=a?t:i,n=a?"100":"40",o=[];for(const t of e)o.push(f({Stage:r,Option:a?t.labelSelf:t.labelTarget,Result:a?t.descriptionSelf:t.descriptionTarget,Function:`DialogBCMAStartMiniGame("${t.id}")`}));return o.push(f({Stage:r,NextStage:n,Option:"(Back to character actions.)",Result:"(Possible character actions.)"})),o}function u(e,a){return!(!a.Option||!a.Stage)&&(!e.some(e=>e.Stage===a.Stage&&e.Option===a.Option)&&(e.push(a),!0))}function f({Stage:e,NextStage:a=null,Option:t=null,Result:i=null,Function:r=null,Prerequisite:n=null,Group:o=null,Trait:l=null}){return{Stage:e??null,NextStage:a,Option:t,Result:i,Function:r,Prerequisite:n,Group:o,Trait:l}}function h(){try{return"function"==typeof ServerPlayerIsInChatRoom&&ServerPlayerIsInChatRoom()}catch{return!1}}globalThis.BCMA_LOADED||(globalThis.BCMA_LOADED=!0,console.log(`[BCMA] Loading Bondage Club Multiplayer Activities v${globalThis.BCMA_VERSION??"dev"}`),function(){const e=globalThis;e.DialogBCMAStartMiniGame||(e.DialogBCMAStartMiniGame=e=>function(e){const t=a.get(e);if(!t)return console.warn(`[BCMA] Unknown mini-game requested: ${e}`),!1;if("function"!=typeof MiniGameStart)return!1;try{return MiniGameStart(t.id,t.difficulty??0,"DialogBCMAMiniGameReturn"),!0}catch(a){return console.error("[BCMA] Failed to start mini-game",e,a),!1}}(e)),e.DialogBCMACanShowMiniGamesSelf||(e.DialogBCMACanShowMiniGamesSelf=()=>h()),e.DialogBCMACanShowMiniGamesTarget||(e.DialogBCMACanShowMiniGamesTarget=()=>{const a=e.CurrentCharacter;return!(!a||a===e.Player)&&("function"!=typeof a.IsPlayer||!a.IsPlayer())&&("function"!=typeof InventoryIsBlockedByDistance||!InventoryIsBlockedByDistance(a))&&h()}),e.DialogBCMACanShowMiniGames||(e.DialogBCMACanShowMiniGames=()=>{const a=e.CurrentCharacter;return a&&"function"==typeof a.IsPlayer&&a.IsPlayer()?e.DialogBCMACanShowMiniGamesSelf():e.DialogBCMACanShowMiniGamesTarget()}),e.DialogBCMAMiniGameReturn||(e.DialogBCMAMiniGameReturn=()=>{"string"==typeof CurrentModule&&"string"==typeof CurrentScreen&&"ChatRoom"===CurrentScreen||"function"==typeof CommonSetScreen&&CommonSetScreen("Online","ChatRoom")})}(),function(){const e=globalThis;if(o)return;const a=e.CharacterBuildDialog;"function"==typeof a?(o=a,e.CharacterBuildDialog=function(e,a,t,i){o?.call(this,e,a,t,i),s(e)}):console.warn("[BCMA] CharacterBuildDialog is not available; mini-game menu injection skipped.")}(),function(){const e=globalThis;if(l)return;const a=e.DialogCanPerformCharacterAction;"function"==typeof a&&(l=a,e.DialogCanPerformCharacterAction=function(){return!!l?.call(this)||"function"==typeof e.DialogBCMACanShowMiniGames&&e.DialogBCMACanShowMiniGames()})}(),c())})();
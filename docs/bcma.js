(()=>{"use strict";const e=Object.freeze([{id:"ClubCard",difficulty:0,labelSelf:"(Practice the Club Card mini-game.)",descriptionSelf:"(Launches a solo Club Card practice round.)",labelTarget:"(Invite DialogCharacterObject to play Club Card.)",descriptionTarget:"(Launches a Club Card practice round for you and DialogCharacterObject.)"},{id:"Chess",difficulty:0,labelSelf:"(Play a practice chess match.)",descriptionSelf:"(Loads the chess mini-game locally.)",labelTarget:"(Challenge DialogCharacterObject to chess.)",descriptionTarget:"(Loads the chess mini-game for you and DialogCharacterObject.)"},{id:"DojoStruggle",difficulty:0,labelSelf:"(Run a dojo struggle drill.)",descriptionSelf:"(Starts the dojo struggle mini-game.)",labelTarget:"(Invite DialogCharacterObject to a dojo struggle drill.)",descriptionTarget:"(Starts the dojo struggle mini-game for DialogCharacterObject.)"},{id:"GetUp",difficulty:0,labelSelf:"(Attempt the Get Up challenge.)",descriptionSelf:"(Starts the Get Up mini-game with a basic difficulty.)",labelTarget:"(Make DialogCharacterObject attempt the Get Up challenge.)",descriptionTarget:"(Starts the Get Up mini-game so DialogCharacterObject can practice.)"},{id:"MaidCleaning",difficulty:"Normal",labelSelf:"(Start maid cleaning practice.)",descriptionSelf:"(Runs the maid cleaning mini-game at a normal pace.)",labelTarget:"(Invite DialogCharacterObject to maid cleaning practice.)",descriptionTarget:"(Runs the maid cleaning mini-game for DialogCharacterObject.)"},{id:"MaidDrinks",difficulty:"Normal",labelSelf:"(Start maid drink service practice.)",descriptionSelf:"(Runs the maid drink service mini-game at a normal pace.)",labelTarget:"(Invite DialogCharacterObject to maid drink service practice.)",descriptionTarget:"(Runs the maid drink service mini-game for DialogCharacterObject.)"},{id:"HorseWalk",difficulty:"Hurdle",labelSelf:"(Race through a horse walk hurdle course.)",descriptionSelf:"(Runs the horse walk mini-game on the hurdle preset.)",labelTarget:"(Invite DialogCharacterObject to a horse walk hurdle course.)",descriptionTarget:"(Runs the horse walk mini-game so DialogCharacterObject can compete.)"},{id:"MagicPuzzle",difficulty:20,labelSelf:"(Practice spell casting puzzles.)",descriptionSelf:"(Loads a Magic Puzzle session.)",labelTarget:"(Invite DialogCharacterObject to practice spell casting puzzles.)",descriptionTarget:"(Loads a Magic Puzzle session for you and DialogCharacterObject.)"},{id:"Therapy",difficulty:1,labelSelf:"(Start a therapy mini-game.)",descriptionSelf:"(Runs the therapy mini-game locally.)",labelTarget:"(Invite DialogCharacterObject to the therapy mini-game.)",descriptionTarget:"(Runs the therapy mini-game for DialogCharacterObject.)"},{id:"Tennis",difficulty:1,labelSelf:"(Practice a tennis mini-game.)",descriptionSelf:"(Loads the tennis mini-game locally.)",labelTarget:"(Invite DialogCharacterObject to tennis drills.)",descriptionTarget:"(Loads the tennis mini-game for you and DialogCharacterObject.)"}]),t=new Map(e.map(e=>[e.id,e])),a=Object.freeze([{id:"Cafe",name:"the Cafe",module:"Room",screen:"Cafe",labelSelf:"(Visit the cafe.)",descriptionSelf:"(Leave the chatroom and grab a snack at the cafe.)",labelTarget:"(Invite DialogCharacterObject to the cafe.)",descriptionTarget:"(Requests DialogCharacterObject to accompany you to the cafe.)"},{id:"Arcade",name:"the Arcade",module:"Room",screen:"Arcade",labelSelf:"(Visit the arcade.)",descriptionSelf:"(Walk over to the club's arcade corner.)",labelTarget:"(Invite DialogCharacterObject to the arcade.)",descriptionTarget:"(Requests DialogCharacterObject to follow you to the arcade.)"},{id:"Stable",name:"the Stable",module:"Room",screen:"Stable",labelSelf:"(Walk to the stables.)",descriptionSelf:"(Head over to the horse stables.)",labelTarget:"(Invite DialogCharacterObject to the stables.)",descriptionTarget:"(Requests DialogCharacterObject to join you at the stables.)"},{id:"Magic",name:"the Magic Theater",module:"Room",screen:"Magic",labelSelf:"(Visit the magic theater.)",descriptionSelf:"(Go see what's happening at the magic theater.)",labelTarget:"(Invite DialogCharacterObject to the magic theater.)",descriptionTarget:"(Requests DialogCharacterObject to come with you to the theater.)"},{id:"Nursery",name:"the Nursery",module:"Room",screen:"Nursery",labelSelf:"(Visit the nursery.)",descriptionSelf:"(Step into the nursery area.)",labelTarget:"(Invite DialogCharacterObject to the nursery.)",descriptionTarget:"(Requests DialogCharacterObject to enter the nursery with you.)"},{id:"Gambling",name:"the Gambling Hall",module:"Room",screen:"Gambling",labelSelf:"(Try your luck in the gambling hall.)",descriptionSelf:"(Walk to the main hall's gambling den.)",labelTarget:"(Invite DialogCharacterObject to the gambling hall.)",descriptionTarget:"(Requests DialogCharacterObject to gamble with you.)"},{id:"Prison",name:"the Prison",module:"Room",screen:"Prison",labelSelf:"(Visit the prison wing.)",descriptionSelf:"(Go check on the prison cells.)",labelTarget:"(Invite DialogCharacterObject to the prison wing.)",descriptionTarget:"(Requests DialogCharacterObject to walk to the prison wing with you.)"},{id:"Photographic",name:"the Photographic Studio",module:"Room",screen:"Photographic",labelSelf:"(Visit the photographic studio.)",descriptionSelf:"(Walk over to the photography studio.)",labelTarget:"(Invite DialogCharacterObject to the photographic studio.)",descriptionTarget:"(Requests DialogCharacterObject to have a photoshoot with you.)"},{id:"Private",name:"your Private Room",module:"Room",screen:"Private",labelSelf:"(Go to your private room.)",descriptionSelf:"(Head over to your own private space.)",labelTarget:"(Invite DialogCharacterObject to your private room.)",descriptionTarget:"(Requests DialogCharacterObject to join you in your private room.)"},{id:"KidnapLeague",name:"the Kidnap League",module:"Room",screen:"KidnapLeague",labelSelf:"(Visit the Kidnap League.)",descriptionSelf:"(Walk to the Kidnap League headquarters.)",labelTarget:"(Invite DialogCharacterObject to the Kidnap League.)",descriptionTarget:"(Requests DialogCharacterObject to head to the Kidnap League.)"},{id:"Shibari",name:"the Shibari Dojo",module:"Room",screen:"Shibari",labelSelf:"(Visit the Shibari dojo.)",descriptionSelf:"(Practice knots at the dojo.)",labelTarget:"(Invite DialogCharacterObject to the Shibari dojo.)",descriptionTarget:"(Requests DialogCharacterObject to train with you at the dojo.)"},{id:"SlaveMarket",name:"the Slave Market",module:"Room",screen:"SlaveMarket",labelSelf:"(Visit the slave market.)",descriptionSelf:"(Leave to browse the slave market.)",labelTarget:"(Invite DialogCharacterObject to the slave market.)",descriptionTarget:"(Requests DialogCharacterObject to join you at the market.)"},{id:"Cell",name:"the Holding Cells",module:"Room",screen:"Cell",labelSelf:"(Visit the holding cells.)",descriptionSelf:"(Walk to the detention cells.)",labelTarget:"(Invite DialogCharacterObject to the holding cells.)",descriptionTarget:"(Requests DialogCharacterObject to step into the cells with you.)"},{id:"Shop",name:"the Club Shop",module:"Room",screen:"Shop",labelSelf:"(Visit the club shop.)",descriptionSelf:"(Walk over to the club shop.)",labelTarget:"(Invite DialogCharacterObject to the club shop.)",descriptionTarget:"(Requests DialogCharacterObject to browse the club shop with you.)"},{id:"MagicSchoolLaboratory",name:"the Magic School Laboratory",module:"Room",screen:"MagicSchoolLaboratory",labelSelf:"(Visit the magic school laboratory.)",descriptionSelf:"(Walk to the magic school's lab.)",labelTarget:"(Invite DialogCharacterObject to the magic school laboratory.)",descriptionTarget:"(Requests DialogCharacterObject to join you in the lab.)",requiresCanChange:!0},{id:"Poker",name:"the Poker room",module:"Room",screen:"Poker",labelSelf:"(Head to the poker room.)",descriptionSelf:"(Leave the chat and sit down for poker.)",labelTarget:"(Invite DialogCharacterObject to the poker room.)",descriptionTarget:"(Requests DialogCharacterObject to play poker with you.)",requiresCanChange:!0,requiresCanTalk:!0,requiresNotRestrained:!0},{id:"Infiltration",name:"the Infiltration training",module:"Room",screen:"Infiltration",labelSelf:"(Visit infiltration training.)",descriptionSelf:"(Walk to the infiltration course.)",labelTarget:"(Invite DialogCharacterObject to infiltration training.)",descriptionTarget:"(Requests DialogCharacterObject to join you in infiltration training.)",requiresCanChange:!0},{id:"MovieStudio",name:"the Movie Studio",module:"Room",screen:"MovieStudio",labelSelf:"(Visit the movie studio.)",descriptionSelf:"(Walk to the film studio.)",labelTarget:"(Invite DialogCharacterObject to the movie studio.)",descriptionTarget:"(Requests DialogCharacterObject to join you on set.)",requiresCanChange:!0}]),o=new Map(a.map(e=>[e.id,e])),i="100",n="9100",r="40",l="9200",c="9300",s="9400",h=Symbol("bcma-self-dialog"),u=Symbol("bcma-target-dialog"),m=new Map,d=new Set,g=new Map,f=new Set;let p,b,C=null,y=!1,S=!1,M=!1,T=!1;const D={Tennis:{prepareState:e=>{globalThis.TennisCharacterLeft=Player??null,globalThis.TennisCharacterRight=e??null,Player&&!Player.Name&&(Player.Name=CharacterNickname(Player)),e&&!e.Name&&(e.Name=CharacterNickname(e))},initSync:(e,t)=>function(e,t){if("number"!=typeof Player?.MemberNumber||"number"!=typeof e.MemberNumber)return void(C=null);const a=globalThis;C={matchId:t,opponentMember:e.MemberNumber,leftMember:Player.MemberNumber,rightMember:e.MemberNumber,lastLeft:"number"==typeof a.TennisCharacterLeftPoint?a.TennisCharacterLeftPoint:0,lastRight:"number"==typeof a.TennisCharacterRightPoint?a.TennisCharacterRightPoint:0}}(e,t)}};function I(e=10){!function(){let e=!1;if(Player&&(e=R(Player)||e),Array.isArray(ChatRoomCharacter))for(const t of ChatRoomCharacter)e=R(t)||e;return e}()&&e>0&&setTimeout(()=>I(e-1),500)}function R(e){return!(!e||!Array.isArray(e.Dialog))&&(e.IsPlayer?.()?function(e){if(e[h])return!1;const t=e.Dialog;if(!Array.isArray(t))return!1;let a=!1;a=w(t,O({Stage:i,NextStage:n,Option:"(BCMA: Launch an activity.)",Result:"(Pick one of the club's built-in mini-games to play or practice.)",Prerequisite:"DialogBCMACanShowMiniGamesSelf()"}))||a,a=w(t,O({Stage:i,NextStage:c,Option:"(BCMA: Visit a club area.)",Result:"(Travel to one of the private club rooms.)",Prerequisite:"DialogBCMACanShowRoomsSelf()"}))||a;for(const e of v(!0))a=w(t,e)||a;for(const e of P(!0))a=w(t,e)||a;return a&&(e[h]=!0),a}(e):!!e.IsOnline?.()&&function(e){if(e[u])return!1;const t=e.Dialog;if(!Array.isArray(t))return!1;let a=!1;a=w(t,O({Stage:r,NextStage:l,Option:"(BCMA: Invite DialogCharacterObject to an activity.)",Result:"(Pick one of the club's built-in mini-games to launch locally.)",Prerequisite:"DialogBCMACanShowMiniGamesTarget()"}))||a,a=w(t,O({Stage:r,NextStage:s,Option:"(BCMA: Visit a club area together.)",Result:"(Invite DialogCharacterObject to follow you into one of the club rooms.)",Prerequisite:"DialogBCMACanShowRoomsTarget()"}))||a;for(const e of v(!1))a=w(t,e)||a;for(const e of P(!1))a=w(t,e)||a;return a&&(e[u]=!0),a}(e))}function v(t){const a=t?n:l,o=t?i:r,c=[];for(const o of e)c.push(O({Stage:a,Option:t?o.labelSelf:o.labelTarget,Result:t?o.descriptionSelf:o.descriptionTarget,Function:t?`DialogBCMAStartMiniGame("${o.id}")`:`DialogBCMAStartMiniGameTarget("${o.id}")`}));return c.push(O({Stage:a,NextStage:o,Option:"(Back to character actions.)",Result:"(Possible character actions.)"})),c}function P(e){const t=e?c:s,o=e?i:r,n=[];for(const o of a)n.push(O({Stage:t,Option:e?o.labelSelf:o.labelTarget,Result:e?o.descriptionSelf:o.descriptionTarget,Function:e?`DialogBCMAVisitRoom("${o.id}")`:`DialogBCMAInviteRoom("${o.id}")`}));return n.push(O({Stage:t,NextStage:o,Option:"(Back to character actions.)",Result:"(Return to the main list of character interactions.)"})),n}function w(e,t){return!(!t.Option||!t.Stage)&&(!e.some(e=>e.Stage===t.Stage&&e.Option===t.Option)&&(e.push(t),!0))}function O({Stage:e,NextStage:t=null,Option:a=null,Result:o=null,Function:i=null,Prerequisite:n=null,Group:r=null,Trait:l=null}){return{Stage:e??null,NextStage:t,Option:a,Result:o,Function:i,Prerequisite:n,Group:r,Trait:l}}function A(e){if("function"==typeof MiniGameStart){"Tennis"!==e.id&&(C=null);try{MiniGameStart(e.id,e.difficulty??0,"DialogBCMAMiniGameReturn")}catch(t){console.error("[BCMA] Failed to start mini-game",e.id,t)}}}function k(e){return e?e.Nickname?e.Nickname:e.Name?e.Name:"number"==typeof e.MemberNumber?`Player ${e.MemberNumber}`:"Unknown player":"Unknown player"}function j(e,t){ServerPlayerIsInChatRoom()&&ServerSend("ChatRoomChat",{Content:"BCMA",Type:"Hidden",Target:e,Dictionary:t})}function B(){if(M)return;const e=globalThis.ChatRoomMessage;"function"==typeof e?(globalThis.ChatRoomMessage=function(a,...i){if("Hidden"!==a?.Type||"BCMA"!==a.Content||"object"!=typeof a.Dictionary)return e.call(this,a,...i);!function(e,a){if("string"==typeof a?.action)switch(a.action){case"invite":!function(e,a){if(a.target!==Player?.MemberNumber)return;const o=G(e),i=t.get(a.gameId);if(!i||!o)return void j(e,{action:"response",id:a.id,gameId:a.gameId,accepted:!1});const n=D[a.gameId];q(`${a.initiatorName} wants to play ${a.gameId}. Accept?`,()=>{n&&(n.prepareState(o),n.initSync?.(o,a.matchId??V())),A(i),j(e,{action:"response",id:a.id,gameId:a.gameId,accepted:!0,matchId:a.matchId}),L()},()=>{j(e,{action:"response",id:a.id,gameId:a.gameId,accepted:!1,matchId:a.matchId}),L()})}(e,a);break;case"response":!function(e){if(!d.has(e.id))return;d.delete(e.id);const a=m.get(e.id);if(m.delete(e.id),!a)return;if(!e.accepted)return void window.alert("BCMA: Invitation declined.");const o=t.get(a.gameId);if(!o)return;const i=D[a.gameId];i&&(i.prepareState(a.opponent),i.initSync?.(a.opponent,a.matchId??e.matchId??V())),A(o)}(a);break;case"forceStart":!function(e,a){const o=D[a.gameId],i=t.get(a.gameId);if(!o||!i)return;const n=G(e);n&&(o.prepareState(n),o.initSync?.(n,a.matchId??V()),A(i))}(e,a);break;case"tennisScore":!function(e){if(C&&e.matchId===C.matchId){y=!0;try{const t=globalThis,a=Player?.MemberNumber;a&&e.leftMember===a?(t.TennisCharacterLeftPoint=e.leftPoints,t.TennisCharacterRightPoint=e.rightPoints):a&&e.rightMember===a?(t.TennisCharacterLeftPoint=e.rightPoints,t.TennisCharacterRightPoint=e.leftPoints):(t.TennisCharacterLeftPoint=e.leftPoints,t.TennisCharacterRightPoint=e.rightPoints),C.lastLeft="number"==typeof t.TennisCharacterLeftPoint?t.TennisCharacterLeftPoint:0,C.lastRight="number"==typeof t.TennisCharacterRightPoint?t.TennisCharacterRightPoint:0}finally{y=!1}}}(a);break;case"roomInvite":!function(e,t){if(t.target!==Player?.MemberNumber)return;const a=G(e),i=o.get(t.roomId);i&&a&&z(i,Player)?q(`${t.initiatorName} wants to bring you to ${i.name}. Accept?`,()=>{U(i),j(e,{action:"roomResponse",id:t.id,roomId:t.roomId,accepted:!0}),L()},()=>{j(e,{action:"roomResponse",id:t.id,roomId:t.roomId,accepted:!1}),L()}):j(e,{action:"roomResponse",id:t.id,roomId:t.roomId,accepted:!1})}(e,a);break;case"roomResponse":!function(e){if(!f.has(e.id))return;f.delete(e.id);const t=g.get(e.id);if(g.delete(e.id),!t)return;if(!e.accepted)return void window.alert("BCMA: Invitation declined.");const a=o.get(t.roomId);a&&z(a,Player)&&U(a)}(a);break;case"roomForce":!function(e,t){const a=o.get(t.roomId);a&&z(a,Player)&&G(e)&&U(a)}(e,a)}}(a.Sender,a.Dictionary)},M=!0):setTimeout(B,500)}let N=null;function q(e,t,a){L(),function(){if(T)return;const e=document.createElement("style");e.textContent="\n.bcma-opponent-overlay {\n\tposition: fixed;\n\tinset: 0;\n\tbackground: rgba(0, 0, 0, 0.6);\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tz-index: 5000;\n}\n.bcma-opponent-dialog {\n\tbackground: #1b1b1f;\n\tcolor: white;\n\tborder: 1px solid #fff;\n\tpadding: 20px;\n\tmax-width: 420px;\n\twidth: 90%;\n\ttext-align: center;\n\tfont-family: Arial, sans-serif;\n\tbox-shadow: 0 0 15px rgba(0, 0, 0, 0.5);\n}\n.bcma-opponent-list {\n\tdisplay: flex;\n\tflex-direction: column;\n\tgap: 10px;\n\tmargin-top: 15px;\n}\n.bcma-opponent-list button {\n\tpadding: 10px;\n\tborder: 1px solid #5a5a74;\n\tbackground: #2d2d3a;\n\tcolor: white;\n\tcursor: pointer;\n}\n.bcma-opponent-list button:hover {\n\tbackground: #38384d;\n}\n",document.head.appendChild(e),T=!0}(),N=document.createElement("div"),N.className="bcma-opponent-overlay";const o=document.createElement("div");o.className="bcma-opponent-dialog";const i=document.createElement("p");i.textContent=e,o.appendChild(i);const n=document.createElement("div");n.className="bcma-opponent-list";const r=document.createElement("button");r.type="button",r.textContent="Accept",r.onclick=t;const l=document.createElement("button");l.type="button",l.textContent="Decline",l.onclick=a,n.appendChild(r),n.appendChild(l),o.appendChild(n),N.appendChild(o),document.body.appendChild(N)}function L(){N&&(N.remove(),N=null)}function G(e){return(Array.isArray(ChatRoomCharacter)?ChatRoomCharacter.find(t=>t.MemberNumber===e):null)??null}function x(){return`${Player?.MemberNumber??"0"}-${Date.now()}-${Math.random().toString(36).slice(2)}`}function V(){return`${Player?.MemberNumber??"0"}-match-${Date.now()}-${Math.random().toString(36).slice(2)}`}function $(){try{return"function"==typeof ServerPlayerIsInChatRoom&&ServerPlayerIsInChatRoom()}catch{return!1}}function W(){if(S)return;const e=globalThis,t=e.TennisRun;"function"==typeof t?(e.TennisRun=function(...e){const a=t.apply(this,e);return function(){if(!C||y)return;const e=globalThis,t="number"==typeof e.TennisCharacterLeftPoint?e.TennisCharacterLeftPoint:0,a="number"==typeof e.TennisCharacterRightPoint?e.TennisCharacterRightPoint:0;t===C.lastLeft&&a===C.lastRight||(C.lastLeft=t,C.lastRight=a,j(C.opponentMember,{action:"tennisScore",gameId:"Tennis",matchId:C.matchId,leftMember:C.leftMember,rightMember:C.rightMember,leftPoints:t,rightPoints:a}))}(),a},S=!0):setTimeout(W,500)}function z(e,t){const a=t??null;return!!a&&!(!1!==e.requiresCanWalk&&"function"==typeof a.CanWalk&&!a.CanWalk()||e.requiresCanChange&&"function"==typeof a.CanChangeOwnClothes&&!a.CanChangeOwnClothes()||e.requiresCanTalk&&"function"==typeof a.CanTalk&&!a.CanTalk()||e.requiresNotRestrained&&"function"==typeof a.IsRestrained&&a.IsRestrained())}function U(e){if("function"==typeof CommonSetScreen)try{CommonSetScreen(e.module,e.screen)}catch(t){console.error("[BCMA] Failed to move to room",e.id,t)}else console.warn("[BCMA] Cannot move to room, CommonSetScreen unavailable")}function E(){const e=Player;return!(!e||"function"==typeof e.CanWalk&&!e.CanWalk())}globalThis.BCMA_LOADED||(globalThis.BCMA_LOADED=!0,console.log(`[BCMA] Loading Bondage Club Multiplayer Activities v${globalThis.BCMA_VERSION??"dev"}`),function(){const e=globalThis;e.DialogBCMAStartMiniGame||(e.DialogBCMAStartMiniGame=e=>function(e){const a=t.get(e);return a?D[e]?(window.alert("BCMA: Please click on the opponent's character actions to start this activity."),!1):(A(a),!0):(console.warn(`[BCMA] Unknown mini-game requested: ${e}`),!1)}(e)),e.DialogBCMAStartMiniGameTarget||(e.DialogBCMAStartMiniGameTarget=e=>function(e){const a=t.get(e);if(!a)return console.warn(`[BCMA] Unknown mini-game requested: ${e}`),!1;const o=CurrentCharacter;if(!o||"function"!=typeof o.IsOnline||!o.IsOnline())return console.warn("[BCMA] No valid opponent selected"),!1;const i=D[e];if(i&&"number"==typeof o.MemberNumber){const t=o.MemberNumber;if(o.IsOwnedByPlayer?.()){i.prepareState(o);const n=V();return i.initSync?.(o,n),j(t,{action:"forceStart",gameId:e,initiator:Player?.MemberNumber??-1,matchId:n}),A(a),!0}const n=V(),r=x();return m.set(r,{gameId:e,opponent:o,matchId:n}),d.add(r),j(t,{action:"invite",id:r,gameId:e,initiator:Player?.MemberNumber??-1,target:t,initiatorName:k(Player),matchId:n}),window.alert(`BCMA: Invitation sent to ${k(o)}.`),!0}return i?(console.warn("[BCMA] Cannot start this game without a valid opponent."),!1):(A(a),!0)}(e)),e.DialogBCMACanShowMiniGamesSelf||(e.DialogBCMACanShowMiniGamesSelf=()=>$()),e.DialogBCMACanShowMiniGamesTarget||(e.DialogBCMACanShowMiniGamesTarget=()=>{const t=e.CurrentCharacter;return!(!t||t===e.Player)&&("function"!=typeof t.IsPlayer||!t.IsPlayer())&&("function"!=typeof InventoryIsBlockedByDistance||!InventoryIsBlockedByDistance(t))&&$()}),e.DialogBCMACanShowMiniGames||(e.DialogBCMACanShowMiniGames=()=>{const t=e.CurrentCharacter;return t&&"function"==typeof t.IsPlayer&&t.IsPlayer()?e.DialogBCMACanShowMiniGamesSelf():e.DialogBCMACanShowMiniGamesTarget()}),e.DialogBCMAMiniGameReturn||(e.DialogBCMAMiniGameReturn=()=>{"string"==typeof CurrentModule&&"string"==typeof CurrentScreen&&"ChatRoom"===CurrentScreen||"function"==typeof CommonSetScreen&&CommonSetScreen("Online","ChatRoom")}),e.DialogBCMAVisitRoom||(e.DialogBCMAVisitRoom=e=>function(e){const t=o.get(e);return t?$()&&E()&&z(t,Player)?(U(t),!0):(window.alert("BCMA: You cannot travel there right now."),!1):(console.warn("[BCMA] Unknown room requested",e),!1)}(e)),e.DialogBCMAInviteRoom||(e.DialogBCMAInviteRoom=e=>function(e){const t=o.get(e);if(!t)return console.warn("[BCMA] Unknown room requested",e),!1;if(!$()||!E()||!z(t,Player))return window.alert("BCMA: You cannot travel there right now."),!1;const a=CurrentCharacter;if(!a||"function"!=typeof a.IsOnline||!a.IsOnline())return console.warn("[BCMA] No valid opponent selected for room invite"),!1;if("number"!=typeof a.MemberNumber)return console.warn("[BCMA] Target is missing a member number"),!1;if(a.IsOwnedByPlayer?.())return j(a.MemberNumber,{action:"roomForce",roomId:e,initiator:Player?.MemberNumber??-1}),U(t),!0;const i=x();return g.set(i,{roomId:e,opponent:a}),f.add(i),j(a.MemberNumber,{action:"roomInvite",id:i,roomId:e,initiator:Player?.MemberNumber??-1,target:a.MemberNumber,initiatorName:k(Player)}),window.alert(`BCMA: Invitation sent to ${k(a)}.`),!0}(e)),e.DialogBCMACanShowRoomsSelf||(e.DialogBCMACanShowRoomsSelf=()=>E()&&$()),e.DialogBCMACanShowRoomsTarget||(e.DialogBCMACanShowRoomsTarget=()=>{const t=e.CurrentCharacter;return!(!t||t===e.Player)&&("function"!=typeof t.IsPlayer||!t.IsPlayer())&&("function"!=typeof InventoryIsBlockedByDistance||!InventoryIsBlockedByDistance(t))&&E()&&$()})}(),function(){const e=globalThis;if(p)return;const t=e.CharacterBuildDialog;"function"==typeof t?(p=t,e.CharacterBuildDialog=function(e,t,a,o){p?.call(this,e,t,a,o),R(e)}):console.warn("[BCMA] CharacterBuildDialog is not available; mini-game menu injection skipped.")}(),function(){const e=globalThis;if(b)return;const t=e.DialogCanPerformCharacterAction;"function"==typeof t&&(b=t,e.DialogCanPerformCharacterAction=function(){return!!b?.call(this)||"function"==typeof e.DialogBCMACanShowMiniGames&&e.DialogBCMACanShowMiniGames()})}(),I(),B(),W())})();
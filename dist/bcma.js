(()=>{var e={992(e,t){!function(){"use strict";const e="1.2.0";function o(e){alert("Mod ERROR:\n"+e);const t=new Error(e);throw console.error(t),t}const n=new TextEncoder;function a(e){return!!e&&"object"==typeof e&&!Array.isArray(e)}function r(e){const t=new Set;return e.filter(e=>!t.has(e)&&t.add(e))}const i=new Map,l=new Set;function c(e){l.has(e)||(l.add(e),console.warn(e))}function s(e){const t=[],o=new Map,n=new Set;for(const a of p.values()){const r=a.patching.get(e.name);if(r){t.push(...r.hooks);for(const[t,i]of r.patches.entries())o.has(t)&&o.get(t)!==i&&c(`ModSDK: Mod '${a.name}' is patching function ${e.name} with same pattern that is already applied by different mod, but with different pattern:\nPattern:\n${t}\nPatch1:\n${o.get(t)||""}\nPatch2:\n${i}`),o.set(t,i),n.add(a.name)}}t.sort((e,t)=>t.priority-e.priority);const a=function(e,t){if(0===t.size)return e;let o=e.toString().replaceAll("\r\n","\n");for(const[n,a]of t.entries())o.includes(n)||c(`ModSDK: Patching ${e.name}: Patch ${n} not applied`),o=o.replaceAll(n,a);return(0,eval)(`(${o})`)}(e.original,o);let r=function(t){var o,r;const i=null===(r=(o=b.errorReporterHooks).hookChainExit)||void 0===r?void 0:r.call(o,e.name,n),l=a.apply(this,t);return null==i||i(),l};for(let o=t.length-1;o>=0;o--){const n=t[o],a=r;r=function(t){var o,r;const i=null===(r=(o=b.errorReporterHooks).hookEnter)||void 0===r?void 0:r.call(o,e.name,n.mod),l=n.hook.apply(this,[t,e=>{if(1!==arguments.length||!Array.isArray(t))throw new Error(`Mod ${n.mod} failed to call next hook: Expected args to be array, got ${typeof e}`);return a.call(this,e)}]);return null==i||i(),l}}return{hooks:t,patches:o,patchesSources:n,enter:r,final:a}}function d(e,t=!1){let o=i.get(e);if(o)t&&(o.precomputed=s(o));else{let t=window;const r=e.split(".");for(let o=0;o<r.length-1;o++)if(t=t[r[o]],!a(t))throw new Error(`ModSDK: Function ${e} to be patched not found; ${r.slice(0,o+1).join(".")} is not object`);const l=t[r[r.length-1]];if("function"!=typeof l)throw new Error(`ModSDK: Function ${e} to be patched not found`);const c=function(e){let t=-1;for(const o of n.encode(e)){let e=255&(t^o);for(let t=0;t<8;t++)e=1&e?-306674912^e>>>1:e>>>1;t=t>>>8^e}return((-1^t)>>>0).toString(16).padStart(8,"0").toUpperCase()}(l.toString().replaceAll("\r\n","\n")),d={name:e,original:l,originalHash:c};o=Object.assign(Object.assign({},d),{precomputed:s(d),router:()=>{},context:t,contextProperty:r[r.length-1]}),o.router=function(e){return function(...t){return e.precomputed.enter.apply(this,[t])}}(o),i.set(e,o),t[o.contextProperty]=o.router}return o}function m(){for(const e of i.values())e.precomputed=s(e)}function u(){const e=new Map;for(const[t,o]of i)e.set(t,{name:t,original:o.original,originalHash:o.originalHash,sdkEntrypoint:o.router,currentEntrypoint:o.context[o.contextProperty],hookedByMods:r(o.precomputed.hooks.map(e=>e.mod)),patchedByMods:Array.from(o.precomputed.patchesSources)});return e}const p=new Map;function h(e){p.get(e.name)!==e&&o(`Failed to unload mod '${e.name}': Not registered`),p.delete(e.name),e.loaded=!1,m()}function f(e,t){e&&"object"==typeof e||o("Failed to register mod: Expected info object, got "+typeof e),"string"==typeof e.name&&e.name||o("Failed to register mod: Expected name to be non-empty string, got "+typeof e.name);let n=`'${e.name}'`;"string"==typeof e.fullName&&e.fullName||o(`Failed to register mod ${n}: Expected fullName to be non-empty string, got ${typeof e.fullName}`),n=`'${e.fullName} (${e.name})'`,"string"!=typeof e.version&&o(`Failed to register mod ${n}: Expected version to be string, got ${typeof e.version}`),e.repository||(e.repository=void 0),void 0!==e.repository&&"string"!=typeof e.repository&&o(`Failed to register mod ${n}: Expected repository to be undefined or string, got ${typeof e.version}`),null==t&&(t={}),t&&"object"==typeof t||o(`Failed to register mod ${n}: Expected options to be undefined or object, got ${typeof t}`);const r=!0===t.allowReplace,i=p.get(e.name);i&&(i.allowReplace&&r||o(`Refusing to load mod ${n}: it is already loaded and doesn't allow being replaced.\nWas the mod loaded multiple times?`),h(i));const l=e=>{let t=u.patching.get(e.name);return t||(t={hooks:[],patches:new Map},u.patching.set(e.name,t)),t},c=(e,t)=>(...a)=>{var r,i;const l=null===(i=(r=b.errorReporterHooks).apiEndpointEnter)||void 0===i?void 0:i.call(r,e,u.name);u.loaded||o(`Mod ${n} attempted to call SDK function after being unloaded`);const c=t(...a);return null==l||l(),c},s={unload:c("unload",()=>h(u)),hookFunction:c("hookFunction",(e,t,a)=>{"string"==typeof e&&e||o(`Mod ${n} failed to patch a function: Expected function name string, got ${typeof e}`);const r=d(e),i=l(r);"number"!=typeof t&&o(`Mod ${n} failed to hook function '${e}': Expected priority number, got ${typeof t}`),"function"!=typeof a&&o(`Mod ${n} failed to hook function '${e}': Expected hook function, got ${typeof a}`);const c={mod:u.name,priority:t,hook:a};return i.hooks.push(c),m(),()=>{const e=i.hooks.indexOf(c);e>=0&&(i.hooks.splice(e,1),m())}}),patchFunction:c("patchFunction",(e,t)=>{"string"==typeof e&&e||o(`Mod ${n} failed to patch a function: Expected function name string, got ${typeof e}`);const r=d(e),i=l(r);a(t)||o(`Mod ${n} failed to patch function '${e}': Expected patches object, got ${typeof t}`);for(const[a,r]of Object.entries(t))"string"==typeof r?i.patches.set(a,r):null===r?i.patches.delete(a):o(`Mod ${n} failed to patch function '${e}': Invalid format of patch '${a}'`);m()}),removePatches:c("removePatches",e=>{"string"==typeof e&&e||o(`Mod ${n} failed to patch a function: Expected function name string, got ${typeof e}`);const t=d(e);l(t).patches.clear(),m()}),callOriginal:c("callOriginal",(e,t,a)=>{"string"==typeof e&&e||o(`Mod ${n} failed to call a function: Expected function name string, got ${typeof e}`);const r=d(e);return Array.isArray(t)||o(`Mod ${n} failed to call a function: Expected args array, got ${typeof t}`),r.original.apply(null!=a?a:globalThis,t)}),getOriginalHash:c("getOriginalHash",e=>("string"==typeof e&&e||o(`Mod ${n} failed to get hash: Expected function name string, got ${typeof e}`),d(e).originalHash))},u={name:e.name,fullName:e.fullName,version:e.version,repository:e.repository,allowReplace:r,api:s,loaded:!0,patching:new Map};return p.set(e.name,u),Object.freeze(s)}function g(){const e=[];for(const t of p.values())e.push({name:t.name,fullName:t.fullName,version:t.version,repository:t.repository});return e}let b;const y=void 0===window.bcModSdk?window.bcModSdk=function(){const t={version:e,apiVersion:1,registerMod:f,getModsInfo:g,getPatchingInfo:u,errorReporterHooks:Object.seal({apiEndpointEnter:null,hookEnter:null,hookChainExit:null})};return b=t,Object.freeze(t)}():(a(window.bcModSdk)||o("Failed to init Mod SDK: Name already in use"),1!==window.bcModSdk.apiVersion&&o(`Failed to init Mod SDK: Different version already loaded ('1.2.0' vs '${window.bcModSdk.version}')`),window.bcModSdk.version!==e&&alert(`Mod SDK warning: Loading different but compatible versions ('1.2.0' vs '${window.bcModSdk.version}')\nOne of mods you are using is using an old version of SDK. It will work for now but please inform author to update`),window.bcModSdk);Object.defineProperty(t,"__esModule",{value:!0}),t.default=y}()}},t={};function o(n){var a=t[n];if(void 0!==a)return a.exports;var r=t[n]={exports:{}};return e[n](r,r.exports,o),r.exports}o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";let e=null,t=null,n=null,a=null,r=null,i=null,l=!1,c=null,s=null,d=[],m=[],u=0;function p(o,d,m,u){i=u??null,r={roomId:o,host:d,guest:m},function(){if(!l){const e=document.createElement("style");e.textContent="\n.bcma-private-room-overlay {\n\tposition: fixed;\n\tinset: 0;\n\tbackground: rgba(10, 0, 20, 0.85);\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tz-index: 6000;\n}\n.bcma-private-room-content {\n\tposition: relative;\n\twidth: 90vw;\n\theight: 90vh;\n\tbackground-size: cover;\n\tbackground-position: center;\n\tbox-shadow: 0 0 25px rgba(0, 0, 0, 0.6);\n\tborder: 2px solid #fff;\n\tdisplay: flex;\n\tflex-direction: column;\n\tpadding: 20px;\n}\n.bcma-private-room-characters {\n\tflex: 1;\n\tdisplay: flex;\n\talign-items: flex-end;\n\tjustify-content: space-around;\n\tgap: 20px;\n}\n.bcma-private-room-character {\n\twidth: 40%;\n\theight: 100%;\n\tdisplay: flex;\n\talign-items: flex-end;\n\tjustify-content: center;\n}\n.bcma-private-room-character img {\n\tmax-width: 100%;\n\tmax-height: 100%;\n\tobject-fit: contain;\n}\n.bcma-private-room-npc-panel {\n\tmargin-top: 10px;\n\tpadding: 10px;\n\tbackground: rgba(0, 0, 0, 0.55);\n\tborder: 1px solid rgba(255, 255, 255, 0.3);\n\tdisplay: flex;\n\tflex-direction: column;\n\tgap: 8px;\n\tmin-height: 220px;\n}\n.bcma-private-room-npc-header {\n\tcolor: #fff;\n\tfont-weight: bold;\n\ttext-align: center;\n}\n.bcma-private-room-npc-stage {\n\tmin-height: 180px;\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: flex-end;\n}\n.bcma-private-room-npc-stage .bcma-private-room-character {\n\twidth: 60%;\n}\n.bcma-private-room-npc-nav {\n\tdisplay: flex;\n\tjustify-content: center;\n\tgap: 10px;\n}\n.bcma-private-room-npc-nav button {\n\tpadding: 6px 14px;\n\tborder: 1px solid #fff;\n\tbackground: rgba(0, 0, 0, 0.6);\n\tcolor: #fff;\n\tcursor: pointer;\n}\n.bcma-private-room-npc-nav button:hover {\n\tbackground: rgba(255, 255, 255, 0.2);\n}\n.bcma-private-room-actions {\n\tdisplay: flex;\n\tjustify-content: flex-end;\n\tgap: 10px;\n}\n.bcma-private-room-actions button {\n\tpadding: 10px 16px;\n\tfont-size: 16px;\n\tborder: 1px solid #fff;\n\tbackground: rgba(0, 0, 0, 0.6);\n\tcolor: #fff;\n\tcursor: pointer;\n}\n.bcma-private-room-actions button:hover {\n\tbackground: rgba(255, 255, 255, 0.15);\n}\n",document.head.appendChild(e),l=!0}if(e)return;e=document.createElement("div"),e.className="bcma-private-room-overlay",t=document.createElement("div"),t.className="bcma-private-room-content",t.style.backgroundImage='url("Backgrounds/PrivateRoom.jpg")';const o=document.createElement("div");o.className="bcma-private-room-characters",n=document.createElement("div"),n.className="bcma-private-room-character",a=document.createElement("div"),a.className="bcma-private-room-character",o.appendChild(n),o.appendChild(a);const r=document.createElement("div");r.className="bcma-private-room-npc-panel";const i=document.createElement("div");i.className="bcma-private-room-npc-header",s=document.createElement("span"),s.textContent="Collecting private NPCs…",i.appendChild(s),c=document.createElement("div"),c.className="bcma-private-room-npc-stage";const d=document.createElement("div");d.className="bcma-private-room-npc-nav";const m=document.createElement("button");m.type="button",m.textContent="◀",m.onclick=()=>b(-1);const u=document.createElement("button");u.type="button",u.textContent="▶",u.onclick=()=>b(1),d.append(m,u),r.append(i,c,d);const p=document.createElement("div");p.className="bcma-private-room-actions";const f=document.createElement("button");f.type="button",f.textContent="Leave private room",f.onclick=()=>h(),p.appendChild(f),t.appendChild(o),t.appendChild(r),t.appendChild(p),e.appendChild(t),document.body.appendChild(e)}(),function(){if(!r||!n||!a)return;const e=v(r.host),t=v(r.guest);f(e,n),f(t,a)}(),g()}function h(o=!0){if(o&&i)try{i()}catch(e){console.error("[BCMA] Private room close callback failed",e)}i=null,r=null,e&&(e.remove(),e=null,t=null,n=null,a=null,c=null,s=null),d=[],m=[],u=0}function f(e,t){if(t.innerHTML="",!e){const e=document.createElement("p");return e.style.color="#fff",e.textContent="Unavailable",void t.appendChild(e)}try{CharacterLoadCanvas?CharacterLoadCanvas(e):CharacterRefresh?.(e);const o=e.Canvas||e.CanvasBlink;if(o){const n=document.createElement("img");return n.alt=e.Nickname??e.Name??"Player",n.src=o.toDataURL("image/png"),void t.appendChild(n)}}catch(e){console.error("[BCMA] Failed to render character canvas",e)}const o=document.createElement("p");o.style.color="#fff",o.textContent=e.Nickname??e.Name??`Player ${e.MemberNumber??"?"}`,t.appendChild(o)}function g(){if(!c||!s)return;const e=y();if(c.innerHTML="",!e.length){const e=document.createElement("p");return e.style.color="#fff",e.textContent=r?"Waiting for NPC data…":"No session active.",c.appendChild(e),void(s.textContent="No NPCs")}u>=e.length&&(u=0);const t=e[u];if(t?.character){const e=document.createElement("div");e.className="bcma-private-room-character",f(t.character,e),c.appendChild(e)}else{const e=document.createElement("p");e.style.color="#fff",e.textContent="NPC preview unavailable.",c.appendChild(e)}s.textContent=t?.name??"NPC",s.style.color=t?.labelColor?t.labelColor:"#fff"}function b(e){const t=y();t.length&&(u=(u+e+t.length)%t.length,g())}function y(){return r?Player&&r.host===Player.MemberNumber?d:m:[]}function C(e,t){const o=e.AccountName||e.MemberNumber||e.Name||`npc-${t}`;return String(o)}function M(e){return e?e.Nickname??e.Name??"NPC":"NPC"}function v(e){if("number"!=typeof e)return null;if(Player?.MemberNumber===e)return Player??null;if(Array.isArray(ChatRoomCharacter)){const t=ChatRoomCharacter.find(t=>t.MemberNumber===e);if(t)return t}return null}async function S(){if("function"==typeof PrivateLoad)try{await PrivateLoad()}catch(e){console.warn("[BCMA] Failed to load private room NPCs",e)}return d=Array.isArray(PrivateCharacter)?PrivateCharacter.filter(e=>e&&e!==Player).map((e,t)=>({id:C(e,t),name:M(e),source:"local",character:e,labelColor:e.LabelColor})):[],g(),Array.isArray(PrivateCharacter)?PrivateCharacter.filter(e=>e&&e!==Player).map((e,t)=>({id:C(e,t),name:M(e),nickname:e.Nickname,title:e.Title,labelColor:e.LabelColor,appearance:"function"==typeof CharacterAppearanceStringify?CharacterAppearanceStringify(e):""})):[]}function w(e){m=e.map(e=>function(e){let t=null;if("function"==typeof CharacterLoadSimple&&"function"==typeof CharacterAppearanceRestore)try{const o=CharacterLoadSimple(`BCMA-PrivateNPC-${e.id}`);e.appearance&&CharacterAppearanceRestore(o,e.appearance),o.Name=e.name,o.Nickname=e.nickname??e.name,t=o}catch(e){console.warn("[BCMA] Failed to build NPC preview",e)}return{id:e.id,name:e.name,source:"remote",character:t,labelColor:e.labelColor}}(e)),u=0,r&&Player&&r.host!==Player.MemberNumber&&g()}var P=o(992),k=o.n(P);let I=null;(()=>{try{const e=globalThis.BCMA_VERSION;I=k().registerMod({name:"BCMA",fullName:"Bondage Club Multiplayer Activities",version:"string"==typeof e?e:"dev",repository:"https://github.com/Lucifer-wen/BCMA-Bondage-Club-Multiplayer-Activities-"})}catch(e){console.warn("[BCMA] ModSDK registration failed; falling back to manual hooks",e),I=null}})();const D=(e,t,o)=>{if(!I)return!1;try{return I.hookFunction(e,t,o),!0}catch(t){return console.error(`[BCMA] Failed to hook ${e} via ModSDK`,t),!1}},T=Object.freeze([{id:"ClubCard",difficulty:0,labelSelf:"(Practice the Club Card mini-game.)",descriptionSelf:"(Launches a solo Club Card practice round.)",labelTarget:"(Invite DialogCharacterObject to play Club Card.)",descriptionTarget:"(Launches a Club Card practice round for you and DialogCharacterObject.)"},{id:"Chess",difficulty:0,labelSelf:"(Play a practice chess match.)",descriptionSelf:"(Loads the chess mini-game locally.)",labelTarget:"(Challenge DialogCharacterObject to chess.)",descriptionTarget:"(Loads the chess mini-game for you and DialogCharacterObject.)"},{id:"DojoStruggle",difficulty:0,labelSelf:"(Run a dojo struggle drill.)",descriptionSelf:"(Starts the dojo struggle mini-game.)",labelTarget:"(Invite DialogCharacterObject to a dojo struggle drill.)",descriptionTarget:"(Starts the dojo struggle mini-game for DialogCharacterObject.)"},{id:"GetUp",difficulty:0,labelSelf:"(Attempt the Get Up challenge.)",descriptionSelf:"(Starts the Get Up mini-game with a basic difficulty.)",labelTarget:"(Make DialogCharacterObject attempt the Get Up challenge.)",descriptionTarget:"(Starts the Get Up mini-game so DialogCharacterObject can practice.)"},{id:"MaidCleaning",difficulty:"Normal",labelSelf:"(Start maid cleaning practice.)",descriptionSelf:"(Runs the maid cleaning mini-game at a normal pace.)",labelTarget:"(Invite DialogCharacterObject to maid cleaning practice.)",descriptionTarget:"(Runs the maid cleaning mini-game for DialogCharacterObject.)"},{id:"MaidDrinks",difficulty:"Normal",labelSelf:"(Start maid drink service practice.)",descriptionSelf:"(Runs the maid drink service mini-game at a normal pace.)",labelTarget:"(Invite DialogCharacterObject to maid drink service practice.)",descriptionTarget:"(Runs the maid drink service mini-game for DialogCharacterObject.)"},{id:"HorseWalk",difficulty:"Hurdle",labelSelf:"(Race through a horse walk hurdle course.)",descriptionSelf:"(Runs the horse walk mini-game on the hurdle preset.)",labelTarget:"(Invite DialogCharacterObject to a horse walk hurdle course.)",descriptionTarget:"(Runs the horse walk mini-game so DialogCharacterObject can compete.)"},{id:"MagicPuzzle",difficulty:20,labelSelf:"(Practice spell casting puzzles.)",descriptionSelf:"(Loads a Magic Puzzle session.)",labelTarget:"(Invite DialogCharacterObject to practice spell casting puzzles.)",descriptionTarget:"(Loads a Magic Puzzle session for you and DialogCharacterObject.)"},{id:"Therapy",difficulty:1,labelSelf:"(Start a therapy mini-game.)",descriptionSelf:"(Runs the therapy mini-game locally.)",labelTarget:"(Invite DialogCharacterObject to the therapy mini-game.)",descriptionTarget:"(Runs the therapy mini-game for DialogCharacterObject.)"},{id:"Tennis",difficulty:1,labelSelf:"(Practice a tennis mini-game.)",descriptionSelf:"(Loads the tennis mini-game locally.)",labelTarget:"(Invite DialogCharacterObject to tennis drills.)",descriptionTarget:"(Loads the tennis mini-game for you and DialogCharacterObject.)"}]),N=new Map(T.map(e=>[e.id,e])),R=Object.freeze([{id:"Cafe",name:"the Cafe",module:"Room",screen:"Cafe",labelSelf:"(Visit the cafe.)",descriptionSelf:"(Leave the chatroom and grab a snack at the cafe.)",labelTarget:"(Invite DialogCharacterObject to the cafe.)",descriptionTarget:"(Requests DialogCharacterObject to accompany you to the cafe.)"},{id:"Arcade",name:"the Arcade",module:"Room",screen:"Arcade",labelSelf:"(Visit the arcade.)",descriptionSelf:"(Walk over to the club's arcade corner.)",labelTarget:"(Invite DialogCharacterObject to the arcade.)",descriptionTarget:"(Requests DialogCharacterObject to follow you to the arcade.)"},{id:"Stable",name:"the Stable",module:"Room",screen:"Stable",labelSelf:"(Walk to the stables.)",descriptionSelf:"(Head over to the horse stables.)",labelTarget:"(Invite DialogCharacterObject to the stables.)",descriptionTarget:"(Requests DialogCharacterObject to join you at the stables.)"},{id:"Magic",name:"the Magic Theater",module:"Room",screen:"Magic",labelSelf:"(Visit the magic theater.)",descriptionSelf:"(Go see what's happening at the magic theater.)",labelTarget:"(Invite DialogCharacterObject to the magic theater.)",descriptionTarget:"(Requests DialogCharacterObject to come with you to the theater.)"},{id:"Nursery",name:"the Nursery",module:"Room",screen:"Nursery",labelSelf:"(Visit the nursery.)",descriptionSelf:"(Step into the nursery area.)",labelTarget:"(Invite DialogCharacterObject to the nursery.)",descriptionTarget:"(Requests DialogCharacterObject to enter the nursery with you.)"},{id:"Gambling",name:"the Gambling Hall",module:"Room",screen:"Gambling",labelSelf:"(Try your luck in the gambling hall.)",descriptionSelf:"(Walk to the main hall's gambling den.)",labelTarget:"(Invite DialogCharacterObject to the gambling hall.)",descriptionTarget:"(Requests DialogCharacterObject to gamble with you.)"},{id:"Prison",name:"the Prison",module:"Room",screen:"Prison",labelSelf:"(Visit the prison wing.)",descriptionSelf:"(Go check on the prison cells.)",labelTarget:"(Invite DialogCharacterObject to the prison wing.)",descriptionTarget:"(Requests DialogCharacterObject to walk to the prison wing with you.)"},{id:"Photographic",name:"the Photographic Studio",module:"Room",screen:"Photographic",labelSelf:"(Visit the photographic studio.)",descriptionSelf:"(Walk over to the photography studio.)",labelTarget:"(Invite DialogCharacterObject to the photographic studio.)",descriptionTarget:"(Requests DialogCharacterObject to have a photoshoot with you.)"},{id:"Private",name:"your Private Room",module:"Room",screen:"Private",mode:"privateSimulation",labelSelf:"(Go to your private room.)",descriptionSelf:"(Head over to your own private space.)",labelTarget:"(Invite DialogCharacterObject to your private room.)",descriptionTarget:"(Requests DialogCharacterObject to join you in your private room.)"},{id:"KidnapLeague",name:"the Kidnap League",module:"Room",screen:"KidnapLeague",labelSelf:"(Visit the Kidnap League.)",descriptionSelf:"(Walk to the Kidnap League headquarters.)",labelTarget:"(Invite DialogCharacterObject to the Kidnap League.)",descriptionTarget:"(Requests DialogCharacterObject to head to the Kidnap League.)"},{id:"Shibari",name:"the Shibari Dojo",module:"Room",screen:"Shibari",labelSelf:"(Visit the Shibari dojo.)",descriptionSelf:"(Practice knots at the dojo.)",labelTarget:"(Invite DialogCharacterObject to the Shibari dojo.)",descriptionTarget:"(Requests DialogCharacterObject to train with you at the dojo.)"},{id:"SlaveMarket",name:"the Slave Market",module:"Room",screen:"SlaveMarket",labelSelf:"(Visit the slave market.)",descriptionSelf:"(Leave to browse the slave market.)",labelTarget:"(Invite DialogCharacterObject to the slave market.)",descriptionTarget:"(Requests DialogCharacterObject to join you at the market.)"},{id:"Cell",name:"the Holding Cells",module:"Room",screen:"Cell",labelSelf:"(Visit the holding cells.)",descriptionSelf:"(Walk to the detention cells.)",labelTarget:"(Invite DialogCharacterObject to the holding cells.)",descriptionTarget:"(Requests DialogCharacterObject to step into the cells with you.)"},{id:"Shop",name:"the Club Shop",module:"Room",screen:"Shop",labelSelf:"(Visit the club shop.)",descriptionSelf:"(Walk over to the club shop.)",labelTarget:"(Invite DialogCharacterObject to the club shop.)",descriptionTarget:"(Requests DialogCharacterObject to browse the club shop with you.)"},{id:"MagicSchoolLaboratory",name:"the Magic School Laboratory",module:"Room",screen:"MagicSchoolLaboratory",labelSelf:"(Visit the magic school laboratory.)",descriptionSelf:"(Walk to the magic school's lab.)",labelTarget:"(Invite DialogCharacterObject to the magic school laboratory.)",descriptionTarget:"(Requests DialogCharacterObject to join you in the lab.)",requiresCanChange:!0},{id:"Poker",name:"the Poker room",module:"Room",screen:"Poker",labelSelf:"(Head to the poker room.)",descriptionSelf:"(Leave the chat and sit down for poker.)",labelTarget:"(Invite DialogCharacterObject to the poker room.)",descriptionTarget:"(Requests DialogCharacterObject to play poker with you.)",requiresCanChange:!0,requiresCanTalk:!0,requiresNotRestrained:!0},{id:"Infiltration",name:"the Infiltration training",module:"Room",screen:"Infiltration",labelSelf:"(Visit infiltration training.)",descriptionSelf:"(Walk to the infiltration course.)",labelTarget:"(Invite DialogCharacterObject to infiltration training.)",descriptionTarget:"(Requests DialogCharacterObject to join you in infiltration training.)",requiresCanChange:!0},{id:"MovieStudio",name:"the Movie Studio",module:"Room",screen:"MovieStudio",labelSelf:"(Visit the movie studio.)",descriptionSelf:"(Walk to the film studio.)",labelTarget:"(Invite DialogCharacterObject to the movie studio.)",descriptionTarget:"(Requests DialogCharacterObject to join you on set.)",requiresCanChange:!0}]),A=new Map(R.map(e=>[e.id,e])),x="100",j="9100",O="40",B="9200",$="9300",E="9400",L=Symbol("bcma-self-dialog"),q=Symbol("bcma-target-dialog"),G=new Map,F=new Set,V=new Map,H=new Set;let K,z,W=null,U=!1,_=!1,Y=null,J=!1,Q=!1;const X={Tennis:{prepareState:e=>{globalThis.TennisCharacterLeft=Player??null,globalThis.TennisCharacterRight=e??null,Player&&!Player.Name&&(Player.Name=CharacterNickname(Player)),e&&!e.Name&&(e.Name=CharacterNickname(e))},initSync:(e,t)=>function(e,t){if("number"!=typeof Player?.MemberNumber||"number"!=typeof e.MemberNumber)return void(W=null);const o=globalThis;W={matchId:t,opponentMember:e.MemberNumber,leftMember:Player.MemberNumber,rightMember:e.MemberNumber,lastLeft:"number"==typeof o.TennisCharacterLeftPoint?o.TennisCharacterLeftPoint:0,lastRight:"number"==typeof o.TennisCharacterRightPoint?o.TennisCharacterRightPoint:0}}(e,t)}};function Z(e=10){!function(){let e=!1;if(Player&&(e=ee(Player)||e),Array.isArray(ChatRoomCharacter))for(const t of ChatRoomCharacter)e=ee(t)||e;return e}()&&e>0&&setTimeout(()=>Z(e-1),500)}function ee(e){return!(!e||!Array.isArray(e.Dialog))&&(e.IsPlayer?.()?function(e){if(e[L])return!1;const t=e.Dialog;if(!Array.isArray(t))return!1;let o=!1;o=ne(t,ae({Stage:x,NextStage:j,Option:"(BCMA: Launch an activity.)",Result:"(Pick one of the club's built-in mini-games to play or practice.)",Prerequisite:"DialogBCMACanShowMiniGamesSelf()"}))||o,o=ne(t,ae({Stage:x,NextStage:$,Option:"(BCMA: Visit a club area.)",Result:"(Travel to one of the private club rooms.)",Prerequisite:"DialogBCMACanShowRoomsSelf()"}))||o;for(const e of te(!0))o=ne(t,e)||o;for(const e of oe(!0))o=ne(t,e)||o;return o&&(e[L]=!0),o}(e):!!e.IsOnline?.()&&function(e){if(e[q])return!1;const t=e.Dialog;if(!Array.isArray(t))return!1;let o=!1;o=ne(t,ae({Stage:O,NextStage:B,Option:"(BCMA: Invite DialogCharacterObject to an activity.)",Result:"(Pick one of the club's built-in mini-games to launch locally.)",Prerequisite:"DialogBCMACanShowMiniGamesTarget()"}))||o,o=ne(t,ae({Stage:O,NextStage:E,Option:"(BCMA: Visit a club area together.)",Result:"(Invite DialogCharacterObject to follow you into one of the club rooms.)",Prerequisite:"DialogBCMACanShowRoomsTarget()"}))||o;for(const e of te(!1))o=ne(t,e)||o;for(const e of oe(!1))o=ne(t,e)||o;return o&&(e[q]=!0),o}(e))}function te(e){const t=e?j:B,o=e?x:O,n=[];for(const o of T)n.push(ae({Stage:t,Option:e?o.labelSelf:o.labelTarget,Result:e?o.descriptionSelf:o.descriptionTarget,Function:e?`DialogBCMAStartMiniGame("${o.id}")`:`DialogBCMAStartMiniGameTarget("${o.id}")`}));return n.push(ae({Stage:t,NextStage:o,Option:"(Back to character actions.)",Result:"(Possible character actions.)"})),n}function oe(e){const t=e?$:E,o=e?x:O,n=[];for(const o of R)n.push(ae({Stage:t,Option:e?o.labelSelf:o.labelTarget,Result:e?o.descriptionSelf:o.descriptionTarget,Function:e?`DialogBCMAVisitRoom("${o.id}")`:`DialogBCMAInviteRoom("${o.id}")`}));return n.push(ae({Stage:t,NextStage:o,Option:"(Back to character actions.)",Result:"(Return to the main list of character interactions.)"})),n}function ne(e,t){return!(!t.Option||!t.Stage)&&(!e.some(e=>e.Stage===t.Stage&&e.Option===t.Option)&&(e.push(t),!0))}function ae({Stage:e,NextStage:t=null,Option:o=null,Result:n=null,Function:a=null,Prerequisite:r=null,Group:i=null,Trait:l=null}){return{Stage:e??null,NextStage:t,Option:o,Result:n,Function:a,Prerequisite:r,Group:i,Trait:l}}function re(e){if("function"==typeof MiniGameStart){"Tennis"!==e.id&&(W=null);try{MiniGameStart(e.id,e.difficulty??0,"DialogBCMAMiniGameReturn")}catch(t){console.error("[BCMA] Failed to start mini-game",e.id,t)}}}function ie(e){return e?e.Nickname?e.Nickname:e.Name?e.Name:"number"==typeof e.MemberNumber?`Player ${e.MemberNumber}`:"Unknown player":"Unknown player"}function le(e,t){ServerPlayerIsInChatRoom()&&ServerSend("ChatRoomChat",{Content:"BCMA",Type:"Hidden",Target:e,Dictionary:t})}function ce(e=0){J||(D("ChatRoomMessage",0,(e,t)=>{const[o]=e;if("Hidden"!==o?.Type||"BCMA"!==o.Content||"object"!=typeof o.Dictionary)return t(e);!function(e,t){if("string"==typeof t?.action)switch(t.action){case"invite":!function(e,t){if(t.target!==Player?.MemberNumber)return;const o=ue(e),n=N.get(t.gameId);if(!n||!o)return void le(e,{action:"response",id:t.id,gameId:t.gameId,accepted:!1});const a=X[t.gameId];de(`${t.initiatorName} wants to play ${t.gameId}. Accept?`,()=>{a&&(a.prepareState(o),a.initSync?.(o,t.matchId??he())),re(n),le(e,{action:"response",id:t.id,gameId:t.gameId,accepted:!0,matchId:t.matchId}),me()},()=>{le(e,{action:"response",id:t.id,gameId:t.gameId,accepted:!1,matchId:t.matchId}),me()})}(e,t);break;case"response":!function(e){if(!F.has(e.id))return;F.delete(e.id);const t=G.get(e.id);if(G.delete(e.id),!t)return;if(!e.accepted)return void window.alert("BCMA: Invitation declined.");const o=N.get(t.gameId);if(!o)return;const n=X[t.gameId];n&&(n.prepareState(t.opponent),n.initSync?.(t.opponent,t.matchId??e.matchId??he())),re(o)}(t);break;case"forceStart":!function(e,t){const o=X[t.gameId],n=N.get(t.gameId);if(!o||!n)return;const a=ue(e);a&&(o.prepareState(a),o.initSync?.(a,t.matchId??he()),re(n))}(e,t);break;case"tennisScore":!function(e){if(W&&e.matchId===W.matchId){U=!0;try{const t=globalThis,o=Player?.MemberNumber;o&&e.leftMember===o?(t.TennisCharacterLeftPoint=e.leftPoints,t.TennisCharacterRightPoint=e.rightPoints):o&&e.rightMember===o?(t.TennisCharacterLeftPoint=e.rightPoints,t.TennisCharacterRightPoint=e.leftPoints):(t.TennisCharacterLeftPoint=e.leftPoints,t.TennisCharacterRightPoint=e.rightPoints),W.lastLeft="number"==typeof t.TennisCharacterLeftPoint?t.TennisCharacterLeftPoint:0,W.lastRight="number"==typeof t.TennisCharacterRightPoint?t.TennisCharacterRightPoint:0}finally{U=!1}}}(t);break;case"roomInvite":!function(e,t){if(t.target!==Player?.MemberNumber)return;const o=ue(e),n=A.get(t.roomId);n&&o&&be(n,Player)?de(`${t.initiatorName} wants to bring you to ${n.name}. Accept?`,()=>{ye(n,{hostMember:t.initiator,guestMember:t.target}),le(e,{action:"roomResponse",id:t.id,roomId:t.roomId,accepted:!0}),me()},()=>{le(e,{action:"roomResponse",id:t.id,roomId:t.roomId,accepted:!1}),me()}):le(e,{action:"roomResponse",id:t.id,roomId:t.roomId,accepted:!1})}(e,t);break;case"roomResponse":!function(e){if(!H.has(e.id))return;H.delete(e.id);const t=V.get(e.id);if(V.delete(e.id),!t)return;if(!e.accepted)return void window.alert("BCMA: Invitation declined.");const o=A.get(t.roomId);if(!o||!be(o,Player))return;const n=t.opponent.MemberNumber??Player?.MemberNumber;ye(o,{hostMember:Player?.MemberNumber,guestMember:n})}(t);break;case"roomForce":!function(e,t){const o=A.get(t.roomId);o&&be(o,Player)&&ue(e)&&ye(o,{hostMember:e,guestMember:Player?.MemberNumber})}(e,t);break;case"roomNpcSync":!function(e){Y&&Y.roomId===e.roomId&&Y.host!==Player?.MemberNumber&&w(e.npcs)}(t);break;case"roomSimClose":!function(e){Y&&Y.roomId===e.roomId&&(Me(!1),window.alert("BCMA: The other player left the private room."))}(t)}}(o.Sender,o.Dictionary)})?J=!0:e>=10?console.warn("[BCMA] Failed to hook ChatRoomMessage via ModSDK after multiple attempts"):setTimeout(()=>ce(e+1),1e3))}let se=null;function de(e,t,o){me(),function(){if(Q)return;const e=document.createElement("style");e.textContent="\n.bcma-opponent-overlay {\n\tposition: fixed;\n\tinset: 0;\n\tbackground: rgba(0, 0, 0, 0.6);\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tz-index: 5000;\n}\n.bcma-opponent-dialog {\n\tbackground: #1b1b1f;\n\tcolor: white;\n\tborder: 1px solid #fff;\n\tpadding: 20px;\n\tmax-width: 420px;\n\twidth: 90%;\n\ttext-align: center;\n\tfont-family: Arial, sans-serif;\n\tbox-shadow: 0 0 15px rgba(0, 0, 0, 0.5);\n}\n.bcma-opponent-list {\n\tdisplay: flex;\n\tflex-direction: column;\n\tgap: 10px;\n\tmargin-top: 15px;\n}\n.bcma-opponent-list button {\n\tpadding: 10px;\n\tborder: 1px solid #5a5a74;\n\tbackground: #2d2d3a;\n\tcolor: white;\n\tcursor: pointer;\n}\n.bcma-opponent-list button:hover {\n\tbackground: #38384d;\n}\n",document.head.appendChild(e),Q=!0}(),se=document.createElement("div"),se.className="bcma-opponent-overlay";const n=document.createElement("div");n.className="bcma-opponent-dialog";const a=document.createElement("p");a.textContent=e,n.appendChild(a);const r=document.createElement("div");r.className="bcma-opponent-list";const i=document.createElement("button");i.type="button",i.textContent="Accept",i.onclick=t;const l=document.createElement("button");l.type="button",l.textContent="Decline",l.onclick=o,r.appendChild(i),r.appendChild(l),n.appendChild(r),se.appendChild(n),document.body.appendChild(se)}function me(){se&&(se.remove(),se=null)}function ue(e){return(Array.isArray(ChatRoomCharacter)?ChatRoomCharacter.find(t=>t.MemberNumber===e):null)??null}function pe(){return`${Player?.MemberNumber??"0"}-${Date.now()}-${Math.random().toString(36).slice(2)}`}function he(){return`${Player?.MemberNumber??"0"}-match-${Date.now()}-${Math.random().toString(36).slice(2)}`}function fe(){try{return"function"==typeof ServerPlayerIsInChatRoom&&ServerPlayerIsInChatRoom()}catch{return!1}}function ge(e=0){_||(D("TennisRun",0,(e,t)=>{const o=t(e);return function(){if(!W||U)return;const e=globalThis,t="number"==typeof e.TennisCharacterLeftPoint?e.TennisCharacterLeftPoint:0,o="number"==typeof e.TennisCharacterRightPoint?e.TennisCharacterRightPoint:0;t===W.lastLeft&&o===W.lastRight||(W.lastLeft=t,W.lastRight=o,le(W.opponentMember,{action:"tennisScore",gameId:"Tennis",matchId:W.matchId,leftMember:W.leftMember,rightMember:W.rightMember,leftPoints:t,rightPoints:o}))}(),o})?_=!0:e>=10?console.warn("[BCMA] Failed to hook TennisRun via ModSDK after multiple attempts"):setTimeout(()=>ge(e+1),1e3))}function be(e,t){const o=t??null;return!!o&&!(!1!==e.requiresCanWalk&&"function"==typeof o.CanWalk&&!o.CanWalk()||e.requiresCanChange&&"function"==typeof o.CanChangeOwnClothes&&!o.CanChangeOwnClothes()||e.requiresCanTalk&&"function"==typeof o.CanTalk&&!o.CanTalk()||e.requiresNotRestrained&&"function"==typeof o.IsRestrained&&o.IsRestrained())}function ye(e,t){if("privateSimulation"!==e.mode)if(Me(!0),"function"==typeof CommonSetScreen)try{CommonSetScreen(e.module,e.screen)}catch(t){console.error("[BCMA] Failed to move to room",e.id,t)}else console.warn("[BCMA] Cannot move to room, CommonSetScreen unavailable");else!function(e,t){Me(!0);const o=t?.hostMember??Player?.MemberNumber,n=t?.guestMember??Player?.MemberNumber;if("number"!=typeof o||"number"!=typeof n)return void console.warn("[BCMA] Missing host/guest information for simulated room",e.id);const a=Player?.MemberNumber,r=a===o?n:o;Y={roomId:e.id,host:o,guest:n,opponent:r===a?void 0:r},p(e.id,o,n,()=>{Ce(!0)}),Player?.MemberNumber===o?S().then(e=>{Y&&Y.host===Player?.MemberNumber&&function(e){if(!Y)return;if(!e.length)return;const t=Y.guest;"number"==typeof t&&t!==Player?.MemberNumber&&le(t,{action:"roomNpcSync",roomId:Y.roomId,owner:Player?.MemberNumber??-1,npcs:e})}(e)}):w([])}(e,t)}function Ce(e){if(!Y)return;const{opponent:t,roomId:o}=Y;Y=null,e&&t&&le(t,{action:"roomSimClose",roomId:o})}function Me(e){Y&&Ce(e),h(!1)}function ve(){const e=Player;return!(!e||"function"==typeof e.CanWalk&&!e.CanWalk())}globalThis.BCMA_LOADED||(globalThis.BCMA_LOADED=!0,console.log(`[BCMA] Loading Bondage Club Multiplayer Activities v${globalThis.BCMA_VERSION??"dev"}`),function(){const e=globalThis;e.DialogBCMAStartMiniGame||(e.DialogBCMAStartMiniGame=e=>function(e){const t=N.get(e);return t?X[e]?(window.alert("BCMA: Please click on the opponent's character actions to start this activity."),!1):(re(t),!0):(console.warn(`[BCMA] Unknown mini-game requested: ${e}`),!1)}(e)),e.DialogBCMAStartMiniGameTarget||(e.DialogBCMAStartMiniGameTarget=e=>function(e){const t=N.get(e);if(!t)return console.warn(`[BCMA] Unknown mini-game requested: ${e}`),!1;const o=CurrentCharacter;if(!o||"function"!=typeof o.IsOnline||!o.IsOnline())return console.warn("[BCMA] No valid opponent selected"),!1;const n=X[e];if(n&&"number"==typeof o.MemberNumber){const a=o.MemberNumber;if(o.IsOwnedByPlayer?.()){n.prepareState(o);const r=he();return n.initSync?.(o,r),le(a,{action:"forceStart",gameId:e,initiator:Player?.MemberNumber??-1,matchId:r}),re(t),!0}const r=he(),i=pe();return G.set(i,{gameId:e,opponent:o,matchId:r}),F.add(i),le(a,{action:"invite",id:i,gameId:e,initiator:Player?.MemberNumber??-1,target:a,initiatorName:ie(Player),matchId:r}),window.alert(`BCMA: Invitation sent to ${ie(o)}.`),!0}return n?(console.warn("[BCMA] Cannot start this game without a valid opponent."),!1):(re(t),!0)}(e)),e.DialogBCMACanShowMiniGamesSelf||(e.DialogBCMACanShowMiniGamesSelf=()=>fe()),e.DialogBCMACanShowMiniGamesTarget||(e.DialogBCMACanShowMiniGamesTarget=()=>{const t=e.CurrentCharacter;return!(!t||t===e.Player)&&("function"!=typeof t.IsPlayer||!t.IsPlayer())&&("function"!=typeof InventoryIsBlockedByDistance||!InventoryIsBlockedByDistance(t))&&fe()}),e.DialogBCMACanShowMiniGames||(e.DialogBCMACanShowMiniGames=()=>{const t=e.CurrentCharacter;return t&&"function"==typeof t.IsPlayer&&t.IsPlayer()?e.DialogBCMACanShowMiniGamesSelf():e.DialogBCMACanShowMiniGamesTarget()}),e.DialogBCMAMiniGameReturn||(e.DialogBCMAMiniGameReturn=()=>{"string"==typeof CurrentModule&&"string"==typeof CurrentScreen&&"ChatRoom"===CurrentScreen||"function"==typeof CommonSetScreen&&CommonSetScreen("Online","ChatRoom")}),e.DialogBCMAVisitRoom||(e.DialogBCMAVisitRoom=e=>function(e){const t=A.get(e);return t?fe()&&ve()&&be(t,Player)?(ye(t,{hostMember:Player?.MemberNumber,guestMember:Player?.MemberNumber}),!0):(window.alert("BCMA: You cannot travel there right now."),!1):(console.warn("[BCMA] Unknown room requested",e),!1)}(e)),e.DialogBCMAInviteRoom||(e.DialogBCMAInviteRoom=e=>function(e){const t=A.get(e);if(!t)return console.warn("[BCMA] Unknown room requested",e),!1;if(!fe()||!ve()||!be(t,Player))return window.alert("BCMA: You cannot travel there right now."),!1;const o=CurrentCharacter;if(!o||"function"!=typeof o.IsOnline||!o.IsOnline())return console.warn("[BCMA] No valid opponent selected for room invite"),!1;if("number"!=typeof o.MemberNumber)return console.warn("[BCMA] Target is missing a member number"),!1;if(o.IsOwnedByPlayer?.())return le(o.MemberNumber,{action:"roomForce",roomId:e,initiator:Player?.MemberNumber??-1}),ye(t,{hostMember:Player?.MemberNumber,guestMember:o.MemberNumber}),!0;const n=pe();return V.set(n,{roomId:e,opponent:o}),H.add(n),le(o.MemberNumber,{action:"roomInvite",id:n,roomId:e,initiator:Player?.MemberNumber??-1,target:o.MemberNumber,initiatorName:ie(Player)}),window.alert(`BCMA: Invitation sent to ${ie(o)}.`),!0}(e)),e.DialogBCMACanShowRoomsSelf||(e.DialogBCMACanShowRoomsSelf=()=>ve()&&fe()),e.DialogBCMACanShowRoomsTarget||(e.DialogBCMACanShowRoomsTarget=()=>{const t=e.CurrentCharacter;return!(!t||t===e.Player)&&("function"!=typeof t.IsPlayer||!t.IsPlayer())&&("function"!=typeof InventoryIsBlockedByDistance||!InventoryIsBlockedByDistance(t))&&ve()&&fe()})}(),function(){const e=globalThis;if(K)return;const t=e.CharacterBuildDialog;"function"==typeof t?(K=t,e.CharacterBuildDialog=function(e,t,o,n){K?.call(this,e,t,o,n),ee(e)}):console.warn("[BCMA] CharacterBuildDialog is not available; mini-game menu injection skipped.")}(),function(){const e=globalThis;if(z)return;const t=e.DialogCanPerformCharacterAction;"function"==typeof t&&(z=t,e.DialogCanPerformCharacterAction=function(){return!!z?.call(this)||"function"==typeof e.DialogBCMACanShowMiniGames&&e.DialogBCMACanShowMiniGames()})}(),Z(),ce(),ge())})()})();
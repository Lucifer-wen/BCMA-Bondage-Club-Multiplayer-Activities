{"version":3,"file":"bcma.dev.js","mappings":";;;;;;;;;;;;;;;AAA4D;AACrD;AACP,IAAI,wEAAoB;AACxB;;;;;;;;;;;;;;;ACHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oEAAoE;AACpE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kDAAkD,QAAQ;AAC1D,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sBAAsB,0HAA0H;AAChJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4DAA4D,GAAG;AAC/D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;UCpTA;UACA;;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;;;;;WC5BA;WACA;WACA;WACA;WACA,yCAAyC,wCAAwC;WACjF;WACA;WACA,E;;;;;WCPA,wF;;;;;WCAA;WACA;WACA;WACA,uDAAuD,iBAAiB;WACxE;WACA,gDAAgD,aAAa;WAC7D,E;;;;;;;;;;;;;;;ACNoD;AAC7C;AACP,uEAAuE,iCAAiC;AACxG,IAAI,iEAAiB;AACrB;AACA;AACA;AACA;AACA;AACA","sources":["webpack://bondage-club-multiplayer-activities/./src/core/register.ts","webpack://bondage-club-multiplayer-activities/./src/modules/minigames.ts","webpack://bondage-club-multiplayer-activities/webpack/bootstrap","webpack://bondage-club-multiplayer-activities/webpack/runtime/define property getters","webpack://bondage-club-multiplayer-activities/webpack/runtime/hasOwnProperty shorthand","webpack://bondage-club-multiplayer-activities/webpack/runtime/make namespace object","webpack://bondage-club-multiplayer-activities/./src/index.ts"],"sourcesContent":["import { registerMiniGameMenu } from \"../modules/minigames\";\nexport function registerCoreHooks() {\n    registerMiniGameMenu();\n}\n","const MINI_GAMES = Object.freeze([\n    {\n        id: \"ClubCard\",\n        difficulty: 0,\n        labelSelf: \"(Practice the Club Card mini-game.)\",\n        descriptionSelf: \"(Launches a solo Club Card practice round.)\",\n        labelTarget: \"(Invite DialogCharacterObject to play Club Card.)\",\n        descriptionTarget: \"(Launches a Club Card practice round for you and DialogCharacterObject.)\",\n    },\n    {\n        id: \"Chess\",\n        difficulty: 0,\n        labelSelf: \"(Play a practice chess match.)\",\n        descriptionSelf: \"(Loads the chess mini-game locally.)\",\n        labelTarget: \"(Challenge DialogCharacterObject to chess.)\",\n        descriptionTarget: \"(Loads the chess mini-game for you and DialogCharacterObject.)\",\n    },\n    {\n        id: \"DojoStruggle\",\n        difficulty: 0,\n        labelSelf: \"(Run a dojo struggle drill.)\",\n        descriptionSelf: \"(Starts the dojo struggle mini-game.)\",\n        labelTarget: \"(Invite DialogCharacterObject to a dojo struggle drill.)\",\n        descriptionTarget: \"(Starts the dojo struggle mini-game for DialogCharacterObject.)\",\n    },\n    {\n        id: \"GetUp\",\n        difficulty: 0,\n        labelSelf: \"(Attempt the Get Up challenge.)\",\n        descriptionSelf: \"(Starts the Get Up mini-game with a basic difficulty.)\",\n        labelTarget: \"(Make DialogCharacterObject attempt the Get Up challenge.)\",\n        descriptionTarget: \"(Starts the Get Up mini-game so DialogCharacterObject can practice.)\",\n    },\n    {\n        id: \"MaidCleaning\",\n        difficulty: \"Normal\",\n        labelSelf: \"(Start maid cleaning practice.)\",\n        descriptionSelf: \"(Runs the maid cleaning mini-game at a normal pace.)\",\n        labelTarget: \"(Invite DialogCharacterObject to maid cleaning practice.)\",\n        descriptionTarget: \"(Runs the maid cleaning mini-game for DialogCharacterObject.)\",\n    },\n    {\n        id: \"MaidDrinks\",\n        difficulty: \"Normal\",\n        labelSelf: \"(Start maid drink service practice.)\",\n        descriptionSelf: \"(Runs the maid drink service mini-game at a normal pace.)\",\n        labelTarget: \"(Invite DialogCharacterObject to maid drink service practice.)\",\n        descriptionTarget: \"(Runs the maid drink service mini-game for DialogCharacterObject.)\",\n    },\n    {\n        id: \"HorseWalk\",\n        difficulty: \"Hurdle\",\n        labelSelf: \"(Race through a horse walk hurdle course.)\",\n        descriptionSelf: \"(Runs the horse walk mini-game on the hurdle preset.)\",\n        labelTarget: \"(Invite DialogCharacterObject to a horse walk hurdle course.)\",\n        descriptionTarget: \"(Runs the horse walk mini-game so DialogCharacterObject can compete.)\",\n    },\n    {\n        id: \"MagicPuzzle\",\n        difficulty: 20,\n        labelSelf: \"(Practice spell casting puzzles.)\",\n        descriptionSelf: \"(Loads a Magic Puzzle session.)\",\n        labelTarget: \"(Invite DialogCharacterObject to practice spell casting puzzles.)\",\n        descriptionTarget: \"(Loads a Magic Puzzle session for you and DialogCharacterObject.)\",\n    },\n    {\n        id: \"Therapy\",\n        difficulty: 1,\n        labelSelf: \"(Start a therapy mini-game.)\",\n        descriptionSelf: \"(Runs the therapy mini-game locally.)\",\n        labelTarget: \"(Invite DialogCharacterObject to the therapy mini-game.)\",\n        descriptionTarget: \"(Runs the therapy mini-game for DialogCharacterObject.)\",\n    },\n    {\n        id: \"Tennis\",\n        difficulty: 1,\n        labelSelf: \"(Practice a tennis mini-game.)\",\n        descriptionSelf: \"(Loads the tennis mini-game locally.)\",\n        labelTarget: \"(Invite DialogCharacterObject to tennis drills.)\",\n        descriptionTarget: \"(Loads the tennis mini-game for you and DialogCharacterObject.)\",\n    },\n]);\nconst GAME_LOOKUP = new Map(MINI_GAMES.map((game) => [game.id, game]));\nconst SELF_MAIN_STAGE = \"100\";\nconst SELF_SUBMENU_STAGE = \"9100\";\nconst TARGET_MAIN_STAGE = \"40\";\nconst TARGET_SUBMENU_STAGE = \"9200\";\nconst SELF_DIALOG_FLAG = Symbol(\"bcma-self-dialog\");\nconst TARGET_DIALOG_FLAG = Symbol(\"bcma-target-dialog\");\nlet originalCharacterBuildDialog;\nlet originalDialogCanPerformCharacterAction;\nexport function registerMiniGameMenu() {\n    installGlobalHelpers();\n    patchCharacterBuildDialog();\n    patchCharacterActionCheck();\n    tryAugmentExistingDialogs();\n}\nfunction installGlobalHelpers() {\n    const globalObj = globalThis;\n    if (!globalObj.DialogBCMAStartMiniGame) {\n        globalObj.DialogBCMAStartMiniGame = (id) => startMiniGame(id);\n    }\n    if (!globalObj.DialogBCMACanShowMiniGamesSelf) {\n        globalObj.DialogBCMACanShowMiniGamesSelf = () => isInChatRoom();\n    }\n    if (!globalObj.DialogBCMACanShowMiniGamesTarget) {\n        globalObj.DialogBCMACanShowMiniGamesTarget = () => {\n            const target = globalObj.CurrentCharacter;\n            if (!target || target === globalObj.Player)\n                return false;\n            if (typeof target.IsPlayer === \"function\" && target.IsPlayer())\n                return false;\n            if (typeof InventoryIsBlockedByDistance === \"function\" && InventoryIsBlockedByDistance(target))\n                return false;\n            return isInChatRoom();\n        };\n    }\n    if (!globalObj.DialogBCMACanShowMiniGames) {\n        globalObj.DialogBCMACanShowMiniGames = () => {\n            const current = globalObj.CurrentCharacter;\n            if (current && typeof current.IsPlayer === \"function\" && current.IsPlayer()) {\n                return globalObj.DialogBCMACanShowMiniGamesSelf();\n            }\n            return globalObj.DialogBCMACanShowMiniGamesTarget();\n        };\n    }\n    if (!globalObj.DialogBCMAMiniGameReturn) {\n        globalObj.DialogBCMAMiniGameReturn = () => {\n            if (typeof CurrentModule === \"string\" && typeof CurrentScreen === \"string\" && CurrentScreen === \"ChatRoom\")\n                return;\n            if (typeof CommonSetScreen === \"function\") {\n                CommonSetScreen(\"Online\", \"ChatRoom\");\n            }\n        };\n    }\n}\nfunction patchCharacterBuildDialog() {\n    const globalObj = globalThis;\n    if (originalCharacterBuildDialog)\n        return;\n    const original = globalObj.CharacterBuildDialog;\n    if (typeof original !== \"function\") {\n        console.warn(\"[BCMA] CharacterBuildDialog is not available; mini-game menu injection skipped.\");\n        return;\n    }\n    originalCharacterBuildDialog = original;\n    globalObj.CharacterBuildDialog = function BCMACharacterBuildDialog(character, csv, prefix, reload) {\n        originalCharacterBuildDialog?.call(this, character, csv, prefix, reload);\n        tryInjectMiniGameMenu(character);\n    };\n}\nfunction patchCharacterActionCheck() {\n    const globalObj = globalThis;\n    if (originalDialogCanPerformCharacterAction)\n        return;\n    const original = globalObj.DialogCanPerformCharacterAction;\n    if (typeof original !== \"function\")\n        return;\n    originalDialogCanPerformCharacterAction = original;\n    globalObj.DialogCanPerformCharacterAction = function BCMADialogCanPerformCharacterAction() {\n        const result = originalDialogCanPerformCharacterAction?.call(this) ?? false;\n        if (result)\n            return true;\n        if (typeof globalObj.DialogBCMACanShowMiniGames === \"function\") {\n            return globalObj.DialogBCMACanShowMiniGames();\n        }\n        return false;\n    };\n}\nfunction tryAugmentExistingDialogs(attempts = 10) {\n    const updated = injectForKnownCharacters();\n    if (!updated && attempts > 0) {\n        setTimeout(() => tryAugmentExistingDialogs(attempts - 1), 500);\n    }\n}\nfunction injectForKnownCharacters() {\n    let injected = false;\n    if (Player) {\n        injected = tryInjectMiniGameMenu(Player) || injected;\n    }\n    if (Array.isArray(ChatRoomCharacter)) {\n        for (const character of ChatRoomCharacter) {\n            injected = tryInjectMiniGameMenu(character) || injected;\n        }\n    }\n    return injected;\n}\nfunction tryInjectMiniGameMenu(character) {\n    if (!character || !Array.isArray(character.Dialog))\n        return false;\n    if (character.IsPlayer?.()) {\n        return injectSelfMenu(character);\n    }\n    if (character.IsOnline?.()) {\n        return injectTargetMenu(character);\n    }\n    return false;\n}\nfunction injectSelfMenu(character) {\n    if (character[SELF_DIALOG_FLAG])\n        return false;\n    const dialog = character.Dialog;\n    if (!Array.isArray(dialog))\n        return false;\n    let modified = false;\n    modified = ensureDialogLine(dialog, createLine({\n        Stage: SELF_MAIN_STAGE,\n        NextStage: SELF_SUBMENU_STAGE,\n        Option: \"(BCMA: Launch an activity.)\",\n        Result: \"(Pick one of the club's built-in mini-games to play or practice.)\",\n        Prerequisite: \"DialogBCMACanShowMiniGamesSelf()\",\n    })) || modified;\n    for (const definition of buildSubMenuLines(true)) {\n        modified = ensureDialogLine(dialog, definition) || modified;\n    }\n    if (modified) {\n        character[SELF_DIALOG_FLAG] = true;\n    }\n    return modified;\n}\nfunction injectTargetMenu(character) {\n    if (character[TARGET_DIALOG_FLAG])\n        return false;\n    const dialog = character.Dialog;\n    if (!Array.isArray(dialog))\n        return false;\n    let modified = false;\n    modified = ensureDialogLine(dialog, createLine({\n        Stage: TARGET_MAIN_STAGE,\n        NextStage: TARGET_SUBMENU_STAGE,\n        Option: \"(BCMA: Invite DialogCharacterObject to an activity.)\",\n        Result: \"(Pick one of the club's built-in mini-games to launch locally.)\",\n        Prerequisite: \"DialogBCMACanShowMiniGamesTarget()\",\n    })) || modified;\n    for (const definition of buildSubMenuLines(false)) {\n        modified = ensureDialogLine(dialog, definition) || modified;\n    }\n    if (modified) {\n        character[TARGET_DIALOG_FLAG] = true;\n    }\n    return modified;\n}\nfunction buildSubMenuLines(selfMenu) {\n    const submenuStage = selfMenu ? SELF_SUBMENU_STAGE : TARGET_SUBMENU_STAGE;\n    const backResult = selfMenu ? \"(Possible character actions.)\" : \"(Possible character actions.)\";\n    const backNextStage = selfMenu ? SELF_MAIN_STAGE : TARGET_MAIN_STAGE;\n    const lines = [];\n    for (const game of MINI_GAMES) {\n        lines.push(createLine({\n            Stage: submenuStage,\n            Option: selfMenu ? game.labelSelf : game.labelTarget,\n            Result: selfMenu ? game.descriptionSelf : game.descriptionTarget,\n            Function: `DialogBCMAStartMiniGame(\"${game.id}\")`,\n        }));\n    }\n    lines.push(createLine({\n        Stage: submenuStage,\n        NextStage: backNextStage,\n        Option: \"(Back to character actions.)\",\n        Result: backResult,\n    }));\n    return lines;\n}\nfunction ensureDialogLine(dialog, candidate) {\n    if (!candidate.Option || !candidate.Stage)\n        return false;\n    const exists = dialog.some((line) => line.Stage === candidate.Stage && line.Option === candidate.Option);\n    if (exists)\n        return false;\n    dialog.push(candidate);\n    return true;\n}\nfunction createLine({ Stage, NextStage = null, Option = null, Result = null, Function = null, Prerequisite = null, Group = null, Trait = null, }) {\n    return {\n        Stage: Stage ?? null,\n        NextStage,\n        Option,\n        Result,\n        Function,\n        Prerequisite,\n        Group,\n        Trait,\n    };\n}\nfunction startMiniGame(id) {\n    const definition = GAME_LOOKUP.get(id);\n    if (!definition) {\n        console.warn(`[BCMA] Unknown mini-game requested: ${id}`);\n        return false;\n    }\n    if (typeof MiniGameStart !== \"function\")\n        return false;\n    try {\n        MiniGameStart(definition.id, definition.difficulty ?? 0, \"DialogBCMAMiniGameReturn\");\n        return true;\n    }\n    catch (error) {\n        console.error(\"[BCMA] Failed to start mini-game\", id, error);\n        return false;\n    }\n}\nfunction isInChatRoom() {\n    try {\n        return typeof ServerPlayerIsInChatRoom === \"function\" && ServerPlayerIsInChatRoom();\n    }\n    catch {\n        return false;\n    }\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Check if module exists (development only)\n\tif (__webpack_modules__[moduleId] === undefined) {\n\t\tvar e = new Error(\"Cannot find module '\" + moduleId + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import { registerCoreHooks } from \"./core/register\";\nexport function bootstrapBCMA() {\n    console.log(`[BCMA] Loading Bondage Club Multiplayer Activities v${globalThis.BCMA_VERSION ?? \"dev\"}`);\n    registerCoreHooks();\n}\n// Auto-start when script injected\nif (!globalThis.BCMA_LOADED) {\n    globalThis.BCMA_LOADED = true;\n    bootstrapBCMA();\n}\n"],"names":[],"ignoreList":[],"sourceRoot":""}